<?phprequire('database/dbconfig.php');if (!isset($_SESSION)) {   session_start();}if (isset($_POST['submit'])) {   $uname = mysqli_real_escape_string($connection, $_POST['username']);   $password = mysqli_real_escape_string($connection, $_POST['password']);   $_SESSION['emailId'] = $uname;   if ($uname != '' && $password != '') {      $query = "SELECT * FROM students WHERE email = '$uname' AND password ='$password'";      $query_run = mysqli_query($connection, $query);      $row = mysqli_fetch_array($query_run);              if (empty($row)) {         $_SESSION['status_code'] = "Invaild Login Credentials!";         header('Location:Login');      } elseif ($row['role'] == 1) {         session_regenerate_id();         $user_session_id_admin1 = session_id();         $adminSession = "UPDATE students SET user_session_id = '$user_session_id_admin1' WHERE role = 1";         $update_query1 = mysqli_query($connection, $adminSession);         $_SESSION['id'] = $row['id'];         $_SESSION['name'] = $row['fname'];         $_SESSION['gender'] = $row['gender'];         $_SESSION['user_session_id'] = $user_session_id_admin1;         $_SESSION['logged_in'] = true;         header('Location:AdminPanel/admindashboard');         exit();      } elseif ($row['role'] == 10 && $row['status'] == 0 ) {                      if($row['users_type'] != 'ExistingStudent'){                                session_regenerate_id();                 $user_session_id_user2 = session_id();                         $userSession = "UPDATE students SET user_session_id = '$user_session_id_user2' WHERE id = '" . $row['id'] . "'";                 $update_query2 = mysqli_query($connection, $userSession);                                 $_SESSION['id'] = $row['id'];                         $_SESSION['name'] = $row['fname'];                         $_SESSION['gender'] = $row['gender'];                                  $_SESSION['paid_Cat'] = $row['Stu_Cat'];                                  $_SESSION['paid_Lang'] = $row['Stu_Sub'];                                  $_SESSION['category'] = $row['category'];                                  $_SESSION['logged_in'] = true;                         $_SESSION['user_session_id'] = $user_session_id_user2;                header('Location:StudentsDashboard/BuyTerm');                 exit();            }else{                    $_SESSION['status_code'] = "Your Account Has Been Under Processing Please Wait for the Admin Approval Email...! OR TRY AGAIN LATER";                    header('Location:Login');            }               } elseif ($row['role'] == 10 && $row['status'] == 1) {         $userid = $row['id'];         // Session id creation         session_regenerate_id();         $user_session_id_user3 = session_id();         $_update = "UPDATE students SET user_session_id = '$user_session_id_user3' WHERE id = '$userid'";         $query_update3 = mysqli_query($connection, $_update);         $_query = "SELECT * FROM terms_details WHERE student_id = $userid AND termname <> 'EBook' AND termname <> 'TEST' ORDER BY id DESC LIMIT 1";         $query_run1 = mysqli_query($connection, $_query);         $row1 = mysqli_fetch_array($query_run1 , MYSQLI_ASSOC);                if ($row1['created_at']) {            $user_registration_date = new DateTime($row1['created_at']);            $today_date = new DateTime();            $trial_period = 11 * 7;            $date_diff = date_diff($user_registration_date, $today_date);            $date_difference = $date_diff->format('%a days');            if ($date_difference >= $trial_period) {               $update_sql = "UPDATE terms_details SET status = 'Pending'  WHERE student_id= $userid ";               $query_run = mysqli_query($connection, $update_sql);               $update_sql = "UPDATE students SET Stu_Status = 'Pending' WHERE id= $userid ";               $query_run = mysqli_query($connection, $update_sql);               $_SESSION['id'] = $userid;               $_SESSION['name'] = $row['fname'];               $_SESSION['logged_in'] = true;               $_SESSION['gender'] = $row['gender'];                              $_SESSION['category'] = $row['category'];                              $_SESSION['paid_Lang'] = $row1['language'];                $_SESSION['paid_Cat'] = $row1['course'];                               $_SESSION['user_session_id'] = $user_session_id_user3;               header('Location:StudentsDashboard/SelectTerm');               exit();            } else {               $_SESSION['id'] = $userid;               $_SESSION['name'] = $row['fname'];               $_SESSION['logged_in'] = true;               $_SESSION['gender'] = $row['gender'];                              $_SESSION['category'] = $row['category'];                              $_SESSION['paid_Lang'] = $row1['language'];                $_SESSION['paid_Cat'] = $row1['course'];                                 $_SESSION['user_session_id'] = $user_session_id_user3;                                header('Location:StudentsDashboard/adminstu');               exit();            }         } elseif($row1['created_at'] == '' &&$row1['termname'] != 'EBook' && $row1['termname'] != 'TEST') {            $_SESSION['id'] = $userid;            $_SESSION['name'] = $row['fname'];            $_SESSION['logged_in'] = true;            $_SESSION['gender'] = $row['gender'];                        $_SESSION['category'] = $row['category'];                         $_SESSION['user_session_id'] = $user_session_id_user3;                          $_SESSION['paid_Lang'] = $row1['language'];            $_SESSION['paid_Cat'] = $row1['course'];            header('Location:StudentsDashboard/SelectTerm');            exit();         }else{                $_SESSION['id'] = $userid;                $_SESSION['name'] = $row['fname'];                $_SESSION['logged_in'] = true;               $_SESSION['gender'] = $row['gender'];                              $_SESSION['category'] = $row['category'];                              $_SESSION['paid_Lang'] = $row1['language'];                $_SESSION['paid_Cat'] = $row1['course'];                                 $_SESSION['user_session_id'] = $user_session_id_user3;                                header('Location:StudentsDashboard/adminstu');               exit();         }      }elseif($row['role'] == 10 && $row['status'] == 2){                   $userid = $row['id'];         // Session id creation         session_regenerate_id();         $user_sessionId = session_id();         $_update = "UPDATE students SET user_session_id = '$user_sessionId' WHERE id = '$userid'";         $query_update3 = mysqli_query($connection, $_update);                      $_SESSION['id'] = $userid;            $_SESSION['name'] = $row['fname'];            $_SESSION['logged_in'] = true;            $_SESSION['gender'] = $row['gender'];                        $_SESSION['category'] = $row['category'];                        $_SESSION['paid_Cat'] = $row['Stu_Cat'];                         $_SESSION['paid_Lang'] = $row['Stu_Sub'];                        $_SESSION['user_session_id'] = $user_sessionId;                         header('Location:StudentsDashboard/SelectTerm');            exit();      }   } else {      header('Location:Login');      exit();   }}